<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial; padding: 10px; }
      table { border-collapse: collapse; margin-bottom: 10px; }
      td { border: 1px solid #999; padding: 5px; }
      input { width: 50px; }
      select, button { margin-top: 5px; padding: 5px; }
    </style>
  </head>
  <body>
    <h2>Edit Layouts</h2>

    <label for="layoutSelect">Select Layout:</label>
    <select id="layoutSelect" onchange="loadLayout()"></select>
    <br><br>

    <div id="layoutContainer"></div>
    <button onclick="saveLayout()">Save Layout</button>
    <button onclick="createNewLayout()">New Layout</button>

    <script>
      // Populate layout dropdown
      google.script.run.withSuccessHandler(function(names){
        const select = document.getElementById('layoutSelect');
        names.forEach(name => {
          const opt = document.createElement('option');
          opt.value = name;
          opt.textContent = name;
          select.appendChild(opt);
        });
        loadLayout();
      }).getLayoutNames();

      function loadLayout() {
        const layoutName = document.getElementById('layoutSelect').value;
        google.script.run.withSuccessHandler(function(html){
          document.getElementById('layoutContainer').innerHTML = html;
        }).getEditableLayout(layoutName);
      }

      function saveLayout() {
        const layoutName = document.getElementById('layoutSelect').value;
        const table = document.querySelector('#layoutContainer table');
        if(!table) return;
        const data = [];
        table.querySelectorAll('tr').forEach(tr => {
          const row = [];
          tr.querySelectorAll('input').forEach(input => row.push(input.value));
          data.push(row);
        });
        google.script.run.saveLayout(layoutName, data);
        alert('Layout saved!');
      }

      function createNewLayout() {
        const name = prompt('Enter new layout name:');
        if(!name) return;
        google.script.run.withSuccessHandler(() => {
          alert('New layout created! Reload the sidebar to see it.');
          const select = document.getElementById('layoutSelect');
          const opt = document.createElement('option');
          opt.value = 'Layout - ' + name;
          opt.textContent = 'Layout - ' + name;
          select.appendChild(opt);
          select.value = 'Layout - ' + name;
          loadLayout();
        }).createNewLayout(name);
      }
    </script>
  </body>
</html>
