<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: 'Google Sans', Arial, sans-serif;
        padding: 16px;
      }
      h2 {
        color: #1a73e8;
        margin-top: 0;
      }
      textarea {
        width: 100%;
        height: 80px;
        font-family: monospace;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ccc;
        resize: vertical;
      }
      button {
        background-color: #1a73e8;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 16px;
        margin-top: 10px;
        cursor: pointer;
        font-size: 13px;
      }
      button:hover {
        background-color: #1669c1;
      }
      #status {
        margin-top: 10px;
        font-size: 13px;
      }
      .error {
        color: #d93025;
      }
      .success {
        color: #188038;
      }
    </style>
  </head>
  <body>
    <h2>Set Preferential Seats</h2>
    <p>Enter a comma-separated list of seat numbers that should be considered <b>preferential</b> (e.g. <code>1,2,3,4</code>).</p>

    <textarea id="seatInput" placeholder="1,2,3,4"></textarea><br>
    <button onclick="saveSeats()">üíæ Save Settings</button>

    <div id="status"></div>

    <script>
      document.addEventListener('DOMContentLoaded', loadSeats);

      // Load currently saved preferential seats
      function loadSeats() {
        const status = document.getElementById('status');
        status.textContent = 'Loading saved seats...';

        google.script.run
          .withSuccessHandler(seats => {
            document.getElementById('seatInput').value = seats && seats.length
              ? seats.join(', ')
              : '';
            status.textContent = 'Loaded successfully.';
            status.className = 'success';
          })
          .withFailureHandler(err => {
            status.textContent = '‚ùå Error loading seats: ' + (err.message || err);
            status.className = 'error';
          })
          .getPreferentialSeats();
      }

      // Save the user‚Äôs input
      function saveSeats() {
        const status = document.getElementById('status');
        let input = document.getElementById('seatInput').value.trim();

        if (!input) {
          status.textContent = '‚ö†Ô∏è Please enter at least one seat number.';
          status.className = 'error';
          return;
        }

        const seats = input
          .split(',')
          .map(s => parseInt(s.trim(), 10))
          .filter(n => !isNaN(n));

        if (seats.length === 0) {
          status.textContent = '‚ö†Ô∏è Invalid format ‚Äî please enter numbers separated by commas.';
          status.className = 'error';
          return;
        }

        status.textContent = 'Saving...';

        google.script.run
          .withSuccessHandler(() => {
            status.textContent = '‚úÖ Preferential seats saved!';
            status.className = 'success';
          })
          .withFailureHandler(err => {
            status.textContent = '‚ùå Error saving seats: ' + (err.message || err);
            status.className = 'error';
          })
          .savePreferentialSeats(seats);
      }
    </script>
  </body>
</html>
